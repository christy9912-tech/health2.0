<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·2.0 Google Trends ç›£æ§</title>
    <!-- ä½¿ç”¨ Tailwind CSS CDN ä¸¦è¨­å®šç‚ºé¡åˆ¥æ¨¡å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --root-font-size: 18px;
        }

        /* é€éæ ¹ç›®éŒ„å­—é«”å¤§å°æ§åˆ¶å…¨å±€æ¯”ä¾‹ */
        html {
            font-size: var(--root-font-size);
        }

        body {
            font-family: 'Inter', "Noto Sans TC", sans-serif;
            scroll-behavior: smooth;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* æ²è»¸æ¨£å¼å„ªåŒ– */
        ::-webkit-scrollbar { width: 0.625rem; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #64748b; border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }

        .trends-card {
            border-radius: 1.5rem;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: 40rem; /* é«˜åº¦éš¨å­—é«”å¤§å°ç¸®æ”¾ */
            display: flex;
            flex-direction: column;
        }
        
        .trends-card:hover {
            transform: translateY(-0.5rem);
            box-shadow: 0 1.5rem 2rem -0.3rem rgba(59, 130, 246, 0.2);
        }

        .loading-shimmer {
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .widget-container {
            flex-grow: 1;
            overflow: hidden;
            position: relative;
        }

        /* æ ¸å¿ƒç¸®æ”¾ï¼šä¿æŒ 1.15 å€ä»¥æ”¾å¤§å…§å®¹ï¼Œä½†å®¹å™¨éš¨å…¨å±€ç¸®æ”¾ */
        iframe {
            border-radius: 0 0 1.5rem 1.5rem;
            position: absolute;
            top: 0;
            left: 0;
            transform: scale(1.15); 
            transform-origin: top left;
            width: 86.95% !important; 
            height: 86.95% !important; 
            transition: opacity 0.5s ease;
        }

        /* æ·±è‰²æ¨¡å¼ä¸‹çš„åœ–è¡¨æ¿¾é¡ */
        .dark iframe {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.2) contrast(0.85);
        }

        .section-header {
            position: relative;
            display: inline-block;
            padding-left: 1.5rem;
            margin: 4rem 0 2.5rem;
        }
        .section-header::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0; width: 0.5rem;
            background: #3B82F6; border-radius: 4px;
        }

        .tab-active {
            background-color: #3B82F6;
            color: #FFFFFF !important;
            box-shadow: 0 0.25rem 1rem rgba(59, 130, 246, 0.6);
            transform: scale(1.05);
        }

        .retry-btn {
            font-size: 0.8rem;
            font-weight: 900;
            background: #3B82F6;
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 0.6rem;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }
        .retry-btn:hover { background: #2563EB; transform: scale(1.1); }

        .loading-overlay {
            position: absolute;
            inset: 0;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        /* æ§åˆ¶å™¨æ¨£å¼ */
        .control-panel {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .fs-btn-active {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .dark .fs-btn-active {
            background-color: #334155;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-50 min-h-screen pb-32">

    <!-- é ‚éƒ¨æ¨™é¡Œèˆ‡æ§åˆ¶é … -->
    <header class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 p-8 shadow-sm">
        <div class="max-w-[1600px] mx-auto flex flex-col lg:flex-row items-center justify-between gap-8">
            <div class="text-center lg:text-left">
                <h1 class="text-5xl md:text-7xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-blue-600 via-blue-400 to-emerald-500 dark:from-blue-400 dark:via-white dark:to-emerald-400">
                    å¥åº·2.0 Google Trends ç›£æ§
                </h1>
                <div class="mt-6 flex flex-wrap items-center justify-center lg:justify-start gap-8">
                    <!-- ä¸»é¡Œåˆ‡æ› -->
                    <div class="control-panel">
                        <span class="text-xs font-bold uppercase tracking-wider opacity-60">é¢¨æ ¼</span>
                        <select id="theme-select" onchange="applyTheme(this.value)" class="bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            <option value="auto">ğŸŒ“ è‡ªå‹•</option>
                            <option value="light">â˜€ï¸ æ·ºè‰²</option>
                            <option value="dark">ğŸŒ™ æ·±è‰²</option>
                        </select>
                    </div>

                    <!-- å…¨å±€å­—é«”å¤§å°åˆ‡æ› -->
                    <div class="control-panel border-l border-slate-200 dark:border-slate-700 pl-8">
                        <span class="text-xs font-bold uppercase tracking-wider opacity-60">é¡¯ç¤ºæ¯”ä¾‹</span>
                        <div class="inline-flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl border border-slate-200 dark:border-slate-700">
                            <button onclick="updateFontSize(14)" id="fs-sm" class="px-5 py-2 text-xs font-bold rounded-lg transition-all">æ¨™æº–</button>
                            <button onclick="updateFontSize(18)" id="fs-md" class="px-5 py-2 text-xs font-bold rounded-lg transition-all">è¼ƒå¤§</button>
                            <button onclick="updateFontSize(22)" id="fs-lg" class="px-5 py-2 text-xs font-bold rounded-lg transition-all">ç‰¹å¤§</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 7å¤©/30å¤©åˆ‡æ›æŒ‰éˆ• -->
            <div class="flex flex-col items-center lg:items-end gap-6">
                <div class="inline-flex p-2 bg-slate-100 dark:bg-slate-800 rounded-3xl border-2 border-slate-200 dark:border-slate-700 shadow-inner">
                    <button onclick="switchTimeRange('now 7-d')" id="btn-7d" class="px-10 py-4 text-xl md:text-2xl font-black rounded-2xl transition-all tab-active">
                        éå» 7 å¤©
                    </button>
                    <button onclick="switchTimeRange('today 1-m')" id="btn-30d" class="px-10 py-4 text-xl md:text-2xl font-black rounded-2xl transition-all text-slate-500 dark:text-slate-400 hover:text-white ml-2">
                        éå» 30 å¤©
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-8">
        <div id="dashboard-content">
            <!-- ç”± JS å‹•æ…‹ç”Ÿæˆå…§å®¹ -->
        </div>
    </main>

    <footer class="max-w-7xl mx-auto mt-32 pt-16 border-t border-slate-200 dark:border-slate-800 text-center">
        <p class="font-black text-slate-800 dark:text-white text-4xl mb-4">è³‡æ–™ä¾†æºï¼šGoogle Trends</p>
        <p class="text-slate-500 dark:text-slate-400 text-xl max-w-4xl mx-auto font-bold">
            â€» è¼‰å…¥åœ–è¡¨ç´„éœ€ 25 ç§’å…¨æ•¸å®Œæˆã€‚è‹¥é¡¯ç¤ºã€ŒRequest Errorã€ï¼Œè«‹é»æ“Šå¡ç‰‡å³ä¸Šè§’çš„ <span class="text-blue-500">RETRY</span> é‡æ–°è®€å–ã€‚
        </p>
    </footer>

    <!-- Google Trends è¼‰å…¥å™¨ -->
    <script type="text/javascript" src="https://ssl.gstatic.com/trends_nrtr/4284_RC01/embed_loader.js"></script>

    <script type="text/javascript">
        const CATEGORIES = [
            { id: 456, name: "ç‡Ÿé¤Š", group: "food", groupName: "é£²é£Ÿèˆ‡ç‡Ÿé¤Š" },
            { id: 908, name: "è”¬æœ", group: "food" },
            { id: 910, name: "æ¹¯å“", group: "food" },
            { id: 825, name: "ç´ é£Ÿ", group: "food" },
            { id: 909, name: "è‚‰å“æµ·é®®", group: "food" },
            { id: 237, name: "ä¿å¥é£Ÿå“", group: "food" },
            { id: 1282, name: "è£œåŠ©", group: "welfare", groupName: "ç¤¾æœƒç¦åˆ©èˆ‡è£œåŠ©" },
            { id: 619, name: "é€€ä¼‘èˆ‡è£œåŠ©é‡‘", group: "welfare" },
            { id: 1239, name: "ä¸­é†«", group: "health_general", groupName: "é†«ç™‚èˆ‡å¥åº·æ¦‚æ³" },
            { id: 947, name: "å…¬å…±å¥åº·", group: "health_general" },
            { keyword: "ç¡çœ ", name: "ç¡çœ ", group: "health_general" },
            { id: 623, name: "è€å¹´é†«å­¸", group: "health_general" },
            { id: 419, name: "å¥åº·ç‹€æ³", group: "health_general" },
            { id: 184, name: "åäºº", group: "health_general" },
            { id: 429, name: "ç™Œç—‡", group: "diseases", groupName: "ç–¾ç—…èˆ‡ç”Ÿç†ç³»çµ±" },
            { id: 1328, name: "å…§åˆ†æ³Œç–¾ç—…", group: "diseases" },
            { id: 559, name: "å¿ƒè‡Ÿç—…é«˜è¡€å£“", group: "diseases" },
            { id: 420, name: "çš®è†šç—…", group: "diseases" },
            { id: 1211, name: "è€³é¼»å–‰", group: "diseases" },
            { id: 824, name: "å‘¼å¸ç³»çµ±å•é¡Œ", group: "diseases" },
            { id: 638, name: "èƒƒé£Ÿé“é€†æµ", group: "diseases" },
            { id: 819, name: "ç–¼ç—›æ§åˆ¶", group: "diseases" },
            { id: 942, name: "ç¥ç¶“ç³»çµ±ç–¾ç—…", group: "diseases" },
            { id: 629, name: "æ™®é€šæ„Ÿå†’èˆ‡æµè¡Œæ„Ÿå†’", group: "diseases" }
        ];

        let currentTimeRange = 'now 7-d';
        let isRendering = false;

        window.onload = function() {
            initTheme();
            initFontSize();
            renderStructure();
            startSequentialLoad(currentTimeRange);
        };

        // --- å…¨å±€å­—é«”å¤§å°/ç¸®æ”¾é‚è¼¯ ---
        function initFontSize() {
            const savedSize = localStorage.getItem('globalFontSize') || 18;
            updateFontSize(parseInt(savedSize));
        }

        function updateFontSize(px) {
            document.documentElement.style.setProperty('--root-font-size', px + 'px');
            localStorage.setItem('globalFontSize', px);
            
            // æ›´æ–°é¸å–æŒ‰éˆ•çš„è¦–è¦ºç‹€æ…‹
            const btns = { 14: 'fs-sm', 18: 'fs-md', 22: 'fs-lg' };
            Object.keys(btns).forEach(size => {
                const el = document.getElementById(btns[size]);
                if (parseInt(size) === px) {
                    el.classList.add('fs-btn-active');
                } else {
                    el.classList.remove('fs-btn-active');
                }
            });
        }

        // --- ä¸»é¡Œåˆ‡æ›é‚è¼¯ ---
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'auto';
            document.getElementById('theme-select').value = savedTheme;
            applyTheme(savedTheme);
        }

        function applyTheme(theme) {
            const html = document.documentElement;
            localStorage.setItem('theme', theme);
            
            if (theme === 'dark') {
                html.classList.add('dark');
            } else if (theme === 'light') {
                html.classList.remove('dark');
            } else {
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    html.classList.add('dark');
                } else {
                    html.classList.remove('dark');
                }
            }
        }

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (localStorage.getItem('theme') === 'auto') {
                applyTheme('auto');
            }
        });

        // --- å„€è¡¨æ¿å»ºæ§‹èˆ‡è¼‰å…¥ ---
        function renderStructure() {
            const container = document.getElementById('dashboard-content');
            container.innerHTML = '';
            let currentGroup = "";

            CATEGORIES.forEach((cat, index) => {
                if (cat.group !== currentGroup) {
                    currentGroup = cat.group;
                    const header = document.createElement('div');
                    header.className = 'section-header w-full';
                    header.innerHTML = `<h2 class="text-4xl font-black text-blue-600 dark:text-blue-400 tracking-widest uppercase">${cat.groupName}</h2>`;
                    container.appendChild(header);

                    const grid = document.createElement('div');
                    grid.id = `grid-${cat.group}`;
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12 mb-24';
                    container.appendChild(grid);
                }

                const gridContainer = document.getElementById(`grid-${cat.group}`);
                const card = document.createElement('div');
                card.className = 'trends-card relative bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 shadow-lg dark:shadow-2xl';
                const uniqueId = cat.id || `kw-${index}`;
                card.innerHTML = `
                    <div class="px-8 py-6 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex items-center justify-between">
                        <h3 class="font-black text-2xl text-slate-800 dark:text-white tracking-tight">${cat.name}</h3>
                        <button onclick="loadWidgetByIndex(${index}, currentTimeRange)" class="retry-btn">RETRY</button>
                    </div>
                    <div class="widget-container">
                        <div id="loading-${uniqueId}" class="loading-overlay bg-white dark:bg-slate-800">
                            <div class="w-12 h-12 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"></div>
                            <span class="loading-text font-bold text-lg animate-pulse text-slate-500 dark:text-slate-400">è¼‰å…¥ä¸­</span>
                        </div>
                        <div id="trend-widget-${uniqueId}" class="w-full h-full"></div>
                    </div>
                `;
                gridContainer.appendChild(card);
            });
        }

        function startSequentialLoad(range) {
            isRendering = true;
            CATEGORIES.forEach((cat, index) => {
                setTimeout(() => {
                    loadWidgetByIndex(index, range);
                    if (index === CATEGORIES.length - 1) isRendering = false;
                }, index * 1200);
            });
        }

        function loadWidgetByIndex(index, range) {
            const cat = CATEGORIES[index];
            const uniqueId = cat.id || `kw-${index}`;
            const container = document.getElementById(`trend-widget-${uniqueId}`);
            const loader = document.getElementById(`loading-${uniqueId}`);
            
            if (!container) return;
            
            container.innerHTML = '';
            if (loader) loader.style.display = 'flex';
            
            const comparisonItem = cat.keyword 
                ? [{ "keyword": cat.keyword, "geo": "TW", "time": range }]
                : [{ "geo": "TW", "time": range }];
            
            const categoryValue = cat.keyword ? 0 : cat.id;

            try {
                window.trends.embed.renderExploreWidgetTo(
                    container,
                    "RELATED_QUERIES",
                    {
                        "comparisonItem": comparisonItem,
                        "category": categoryValue,
                        "property": ""
                    },
                    {
                        "exploreQuery": cat.keyword 
                            ? `date=${encodeURIComponent(range)}&geo=TW&q=${encodeURIComponent(cat.keyword)}&hl=zh-TW`
                            : `cat=${cat.id}&date=${encodeURIComponent(range)}&geo=TW&hl=zh-TW`,
                        "guestPath": "https://trends.google.com.tw:443/trends/embed/"
                    }
                );
                setTimeout(() => {
                    if (loader) loader.style.display = 'none';
                }, 2500);
            } catch (e) {
                console.error(e);
                if (loader) loader.innerHTML = `<span class="text-red-500 font-bold text-lg">FAIL</span>`;
            }
        }

        function switchTimeRange(range) {
            if (currentTimeRange === range || isRendering) return;
            currentTimeRange = range;

            document.getElementById('btn-7d').className = `px-10 py-4 text-xl md:text-2xl font-black rounded-2xl transition-all ${range === 'now 7-d' ? 'tab-active' : 'text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white'}`;
            document.getElementById('btn-30d').className = `px-10 py-4 text-xl md:text-2xl font-black rounded-2xl transition-all ml-2 ${range === 'today 1-m' ? 'tab-active' : 'text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white'}`;

            renderStructure();
            startSequentialLoad(range);
        }
    </script>
</body>
</html>
